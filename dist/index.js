import{Router as p}from"itty-router";import{Response as o}from"@cloudflare/workers-types";import{InteractionResponseType as c,InteractionType as a,verifyKey as u}from"discord-interactions";import i from"./lib/env.js";class s extends o{constructor(n,t={headers:{"content-type":"application/json;charset=UTF-8"}}){super(JSON.stringify(n),t)}}const r=p();r.post("/discord",async(e,n)=>{const t=await e.json();if(t.type===a.PING)return new s({type:c.PONG});if(t.type===a.APPLICATION_COMMAND)switch(t.data.name.toLowerCase()){case"invite":return new s({type:4,data:{content:`https://discord.com/oauth2/authorize?client_id=${n.DISCORD_APPLICATION_ID}&scope=applications.commands`,flags:64}});default:return new s({error:"Unknown Type"},{status:400})}return new s({error:"Unknown Type"},{status:400})}),r.all("*",()=>new o("404 | Not Found.",{status:404}));var w={async fetch(e,n=i){return e.method==="POST"&&!u(await e.clone().arrayBuffer(),e.headers.get("x-signature-ed25519")??"",e.headers.get("x-signature-timestamp")??"",n.DISCORD_PUBLIC_KEY)?(console.error("Invalid Request"),new o("Bad request signature.",{status:401})):r.handle(e,i)}};export{w as default};
